# üîê Authentication Configuration - Rendio AI

**Date:** 2025-11-05
**Status:** ‚úÖ Phase 0 Complete (Placeholders for Apple credentials)

---

## üéØ Enabled Authentication Methods

### 1. ‚úÖ Anonymous Sign-In (Guest Users)
**Status:** Fully configured and working

**Purpose:**
- Allows users to use the app without creating an account
- Guests get a JWT token for RLS (Row Level Security)
- Guests get 10 free credits on first launch (via DeviceCheck)

**How it works:**
```swift
// iOS app calls
let session = try await supabase.auth.signInAnonymously()
let userId = session.user.id
```

**User Flow:**
1. User opens app for the first time
2. App calls `signInAnonymously()`
3. User gets JWT token (stored in Keychain)
4. Backend creates user record with `is_guest = true`
5. DeviceCheck verification grants 10 credits

---

### 2. ‚úÖ Apple Sign-In (Registered Users)
**Status:** Enabled with placeholder credentials

**Configuration:**
- **Provider:** Apple
- **Redirect URL:** `https://ojcnjxzctnwbmupggoxq.supabase.co/auth/v1/callback`
- **Apple Bundle ID:** `com.rendioai.app` (PLACEHOLDER - update in Phase 0.5)
- **Apple Services ID:** `com.rendioai.app.signin` (PLACEHOLDER)
- **Apple Team ID:** `TEMP123456` (PLACEHOLDER - get from Apple Developer)
- **Apple Key ID:** `TEMP123456` (PLACEHOLDER - get from Apple Developer)
- **Apple Private Key:** Not yet configured (add in Phase 0.5)

**TODO (Phase 0.5):**
- [ ] Get Apple Team ID from Apple Developer Console
- [ ] Create Apple Services ID
- [ ] Generate Apple Sign-In Key
- [ ] Update Supabase with real credentials

**User Flow:**
1. User taps "Sign in with Apple"
2. iOS shows Apple Sign-In sheet
3. User authenticates with Face ID/Touch ID
4. App gets Apple ID token
5. App sends to Supabase
6. Supabase creates user with `apple_sub` and `email`
7. User's guest credits transfer to registered account

---

## üåê Redirect URLs

Configured redirect URLs for authentication callbacks:

```
rendioai://auth/callback    (iOS deep link)
rendioai://                 (iOS app scheme)
http://localhost:3000       (Local testing)
https://ojcnjxzctnwbmupggoxq.supabase.co (Dashboard)
```

---

## üîë JWT Configuration

**JWT Secret:** Auto-generated by Supabase (never expose!)

**JWT Expiry:**
- Default: 3600 seconds (1 hour)
- Refresh token: 30 days

**Token Refresh:**
iOS app should auto-refresh tokens using:
```swift
try await supabase.auth.refreshSession()
```

---

## üõ°Ô∏è Security Features

### Enabled:
- ‚úÖ Row Level Security (RLS) on all tables
- ‚úÖ Anonymous users isolated (can't see other users' data)
- ‚úÖ JWT tokens required for all API calls
- ‚úÖ Secure password hashing (bcrypt)
- ‚úÖ Rate limiting on auth endpoints (built-in Supabase)

### TODO (Phase 0.5+):
- [ ] DeviceCheck integration (prevent credit farming)
- [ ] Apple IAP receipt validation
- [ ] IP-based rate limiting (Phase 8)
- [ ] Admin authentication (Phase 9)

---

## üì± iOS Integration

### Supabase Client Setup:

```swift
import Supabase

let supabase = SupabaseClient(
    supabaseURL: URL(string: "https://ojcnjxzctnwbmupggoxq.supabase.co")!,
    supabaseKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9qY25qeHpjdG53Ym11cGdnb3hxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMjkzNjIsImV4cCI6MjA3NzkwNTM2Mn0._bKw_0kYf65SxYC8ik3_SMdMgUYoxgVbisvCdRfYo08"
)
```

### Anonymous Sign-In:

```swift
func signInAsGuest() async throws {
    let session = try await supabase.auth.signInAnonymously()
    print("Guest user ID: \(session.user.id)")
}
```

### Apple Sign-In:

```swift
import AuthenticationServices

func signInWithApple() async throws {
    let appleIDProvider = ASAuthorizationAppleIDProvider()
    let request = appleIDProvider.createRequest()
    request.requestedScopes = [.email, .fullName]

    // Handle auth response...
    // Then send to Supabase
    let session = try await supabase.auth.signInWithIdToken(
        credentials: .init(
            provider: .apple,
            idToken: appleIDToken
        )
    )
}
```

---

## ‚úÖ Verification Checklist

- [x] Anonymous sign-in enabled
- [x] Apple provider enabled
- [x] Redirect URLs configured
- [x] JWT expiry set to 1 hour
- [ ] Apple credentials (Phase 0.5)
- [ ] DeviceCheck keys (Phase 0.5)
- [ ] Test anonymous login (Phase 1)
- [ ] Test Apple login (Phase 1)

---

## üîó Useful Links

- **Supabase Auth Dashboard:** https://ojcnjxzctnwbmupggoxq.supabase.co/project/ojcnjxzctnwbmupggoxq/auth/users
- **Apple Developer Console:** https://developer.apple.com
- **Supabase Auth Docs:** https://supabase.com/docs/guides/auth

---

**Status:** ‚úÖ Phase 0 authentication setup complete!
**Next:** Phase 0.5 - Add real Apple credentials and DeviceCheck keys
